/*
 tagorila 2015-08-25 
*/
"use strict";var app=angular.module("app",["ngAnimate","ngDialog","ngRoute","angular-preload-image","ngMaterial","angular-whenScrolled"]).config(["$locationProvider","$routeProvider","$sceDelegateProvider",function(a,b,c){a.html5Mode(!0),b.when("/search/:searchText",{templateUrl:"views/search.html",controller:"SearchCtrl"}),b.when("/media/:itemId",{templateUrl:"views/user.html",controller:"SearchCtrl"}),b.when("/search/",{templateUrl:"views/search.html",controller:"SearchCtrl"}),b.when("/user/",{templateUrl:"views/user.html",controller:"SearchCtrl"}),b.when("/user/:username",{templateUrl:"views/user.html",controller:"SearchCtrl"}),b.when("/tos/",{templateUrl:"views/tos.html"}),b.otherwise({redirectTo:"/search/"}),c.resourceUrlWhitelist(["self","https://scontent.cdninstagram.com/**"])}]).run(["$route","$rootScope","$location",function(a,b,c){var d=c.path;c.path=function(e,f){if(f===!1)var g=a.current,h=b.$on("$locationChangeSuccess",function(){a.current=g,h()});return d.apply(c,[e])}}]);app.service("anchorSmoothScroll",function(){this.scrollTo=function(a){function b(){return self.pageYOffset?self.pageYOffset:document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop?document.body.scrollTop:0}function c(a){for(var b=document.getElementById(a),c=b.offsetTop,d=b;d.offsetParent&&d.offsetParent!=document.body;)d=d.offsetParent,c+=d.offsetTop;return c}var d=b(),e=c(a),f=e>d?e-d:d-e;if(100>f)return void scrollTo(0,e);var g=Math.round(f/100);g>=20&&(g=20);var h=Math.round(f/25),i=e>d?d+h:d-h,j=0;if(e>d)for(var k=d;e>k;k+=h)setTimeout("window.scrollTo(0, "+i+")",j*g),i+=h,i>e&&(i=e),j++;else for(var k=d;k>e;k-=h)setTimeout("window.scrollTo(0, "+i+")",j*g),i-=h,e>i&&(i=e),j++}}),app.factory("Instagram",["$http",function(a){var b="https://api.instagram.com/v1",c="1ca7d98f346549fc95641d0b04307f82";return{get:function(d,e){var f="/tags/"+e+"/media/recent",g=b+f,h={params:{client_id:c,count:d,callback:"JSON_CALLBACK"}};return a.jsonp(g,h)}}}]),app.factory("Instagram2",["$http",function(a){return{get:function(b,c){var d=c,e={params:{count:b,callback:"JSON_CALLBACK"}};return a.jsonp(d,e)}}}]),app.factory("Instagram3",["$http",function(a){return{get:function(b,c){var d="https://api.instagram.com/v1",e="1ca7d98f346549fc95641d0b04307f82",f="/users/"+c+"/media/recent",g=d+f,h={params:{client_id:e,count:b,callback:"JSON_CALLBACK"}};return a.jsonp(g,h)}}}]),app.factory("instaLink",["$http",function(a){return{get:function(b){var c="https://api.instagram.com/oembed?url=http://instagram.com/p/",d="1ca7d98f346549fc95641d0b04307f82",e=b,f=c+e,g={params:{client_id:d,callback:"JSON_CALLBACK"}};return a.jsonp(f,g)}}}]),app.factory("instaMedia",["$http",function(a){return{get:function(b){var c="https://api.instagram.com/v1",d="1ca7d98f346549fc95641d0b04307f82",e="/media/"+b,f=c+e,g={params:{client_id:d,callback:"JSON_CALLBACK"}};return a.jsonp(f,g)}}}]),app.factory("Instagram4",["$http",function(a){var b="https://api.instagram.com/v1";return{get:function(c,d){var e="/media/popular?",f=b+e,g={params:{access_token:d,count:c,callback:"JSON_CALLBACK"}};return a.jsonp(f,g)}}}]),app.controller("SearchCtrl",["$scope","$rootScope","$route","$routeParams","$location","$anchorScroll","Instagram","Instagram2","Instagram3","Instagram4","instaMedia","instaLink","ngDialog","anchorSmoothScroll","$window","$mdDialog",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p){b.what=[],b.modal=[],b.modal.yo=[],a.location=e,b.tagLink=function(a){window.open("http://tagori.la/search/"+a,"_self")},b.swipe=function(){m.close()},b.modalOpen=function(b){a.what.iUrl=b;var c=a.what.iUrl.split("/");a.what.instaUrl=c[4],e.path("/media/"+a.what.instaUrl,!1)},b.openPlain=function(d,f,g,h,i,j,k,l,n,o){a.what.enl=d,a.what.lin=f,a.what.cap=g,a.what.usern=h,a.what.daty=i,a.what.video=j,a.what.likes=k,a.what.tags=l,a.what.uId=n,a.what.mediaId=o,b.theme="ngdialog-theme-plain";var p=m.open({template:'<div class="ngdialog-message col-md-8 col-md-push-2" md-swipe-left="swipe()"  md-swipe-right="swipe()"><div class="panel-body row"><video class="vid col-md-8" ng-show="what.video.length>1" width="100%" height="auto" controls  src="{{what.video}}"  type="video/mp4"></video><div class="modal-pic col-md-8" ng-hide="what.video.length>1"><a ng-href="{{what.enl}}"><img preload-image ng-src="{{what.enl}}" default-image="img/loading-bubbles.svg" src="" alt=""></a></div><div class="modal-text col-md-4"><h1><a ng-href="http://tagori.la/user/{{what.uId}}">{{what.usern}}</a></h1><div class="pull-right modal-likes"><span class="glyphicon glyphicon-heart" aria-hidden="true"></span> {{what.likes}}</div><div class="date">{{what.daty*1000 | date}}</div><p class="modal-close">*swipe to close</p><p>{{what.cap}}</p><p><strong>Tags:</strong></p><div class="tag-container"><md-button ng-click="tagLink(tag)" ng-repeat="tag in what.tags" class="tags md-raised md-primary"> #{{tag}} </md-button></div><md-button class="md-primary" aria-label="Open in Instagram" style="display:block;text-align:right;" ng-href="{{what.lin}}">Open in Instagram <span class="glyphicon glyphicon-share-alt"></md-button></div></div>',className:"ngdialog-theme-plain",plain:!0});p.closePromise.then(function(a){"search"===c.current.scope.view&&e.path("/"+c.current.scope.view+"/"+c.current.params.searchText,!1),"user"===c.current.scope.view&&e.path("/"+c.current.scope.view+"/"+c.current.params.username,!1)})},a.$watch("$routeChangeStart",function(){var c=e.path().split("/");a.search=c[2],a.view=c[1],a.modal=c[3],b.items=null,b.pagination=null,"media"===a.view&&a.search.length>9&&l.get(a.search).success(function(c){a.shortLink=c.media_id,k.get(a.shortLink).success(function(c){return 200!==c.meta.code?(a.error=c.meta.error_type+" | "+c.meta.error_message,void console.log("nothing")):(a.medias=c.data,a.medias.img=c.data.images,i.get(6,a.medias.user.id).success(function(a){q(b,a)}),document.title=a.medias.user.username+"'s media | TAGORI.LA",void(a.medias.videos?b.openPlain(a.medias.img.standard_resolution.url,a.medias.link,a.medias.caption.text,a.medias.user.username,a.medias.created_time,a.medias.videos.standard_resolution.url,a.medias.likes.count,a.medias.tags,a.medias.user.id,a.medias.id):b.openPlain(a.medias.img.standard_resolution.url,a.medias.link,a.medias.caption.text,a.medias.user.username,a.medias.created_time,[],a.medias.likes.count,a.medias.tags,a.medias.user.id,a.medias.id)))})}),"search"===a.view&&a.search.length>1&&g.get(24,a.search).success(function(c){q(b,c),document.title="#"+a.search+" | TAGORI.LA"}),"search"===a.view&&a.search.length<1&&(a.items=null,a.error=null,document.title="TAGORI.LA | Instagram viewer"),"user"===a.view&&a.search.length>1&&i.get(24,a.search).success(function(c){q(b,c),a.gotoElement("hashtext"),document.title=a.items[0].user.username+"'s feed' | TAGORI.LA"}),"user"===a.view&&a.search.length<1?(a.items=null,a.error=null,document.title="TAGORI.LA | Instagram viewer"):document.title="TAGORI.LA | Instagram viewer"}),b.$on("$routeChangeStart",function(a,c,d){return"yarr"!==b.modal.yo?!0:void m.close()}),b.$on("ngDialog.opened",function(a,c){b.modal.yo="yarr"}),b.$on("ngDialog.closing",function(a,c){b.modal.yo=[]}),a.loading=!1,a.itemsDisplayedInList=24,a.loadMore=function(){a.loading||(a.noMore=!1,a.loading=!0,h.get(24,a.pagination).success(function(b){return 200!==b.meta.code?void(a.error=b.meta.error_type+" | "+b.meta.error_message):void(b.data.length>0?(a.pagination=b.pagination.next_url,a.items=b.data.concat(a.items),a.loading=!1,a.itemsDisplayedInList<=a.items.length&&(a.itemsDisplayedInList=a.itemsDisplayedInList+24,a.loading=!1),b.data.length<1&&(a.error="no more results")):a.error="no results")}).error(function(b){console.log("error"),a.noMore=!0}))},a.gotoElement=function(a){n.scrollTo(a)};var q=function(b,c){return 200!==c.meta.code?(b.error,a.$watch("scope.error",function(a){p.show(p.alert().title("Error").content(c.meta.error_type+" | "+c.meta.error_message).ariaLabel("Error").ok("Ok").targetEvent(a))}),void(b.error="")):void(c.data.length>0?(b.error="",b.items=c.data,c.pagination&&(b.error="",b.items=c.data,b.pagination=c.pagination.next_url)):(b.error,a.$watch("scope.error",function(a){p.show(p.alert().title("Error").content("This hashtag has returned no results").ariaLabel("Error").ok("Ok").targetEvent(a))})))}}]),angular.module("litl",[]).directive("scrollRepeat",["$window","$timeout",function(a,b){function c(){var b=a.innerWidth!==f,c=a.innerHeight!==e;f=a.innerWidth,e=a.innerHeight,g=void 0,h&&h({widthChanged:b,heightChanged:c})}var d,e,f,g,h,i,j,k,l=30,m=500,n=l,o=1,p=50,q=200,r=500,s=angular.element(a),t=angular.element(a.document.body),u=500,v=0,w=500,x=200;return c(),s.bind("resize",function(){(angular.isUndefined(e)||angular.isUndefined(f)||angular.isUndefined(g))&&c(),b.cancel(g),g=b(c,u)}),s.bind("scroll",function(){v=a.document.body.scrollTop,angular.isUndefined(i)&&(i=b(function(){k&&k("debounced"),i=void 0},w)),b.cancel(j),j=b(function(){k("ended")},x),k&&k()}),{compile:function(a,c){for(var f,g,i='<div class="scroll-repeat-item"></div>',j='<div class="scroll-repeat-item scroll-repeat-item-placeholder"></div>',s='<div class="scroll-repeat-item-content"></div>',u=c.scrollRepeat,w=a.children(),x=0;x<w.length;x++){var y=w[x];if(y&&"object"==typeof y){var z=angular.element(y);y.hasAttribute("scroll-repeat-item")?f=z.contents():y.hasAttribute("scroll-repeat-placeholder")&&(g=z.contents())}}f||(f=a.contents());var A=angular.element(i),B=angular.element(s);B.append(angular.element(f)),A.append(B),a.html(""),a.append(A);var C=u.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+as\s+([\s\S]+?))?(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),D=C[2];return A.attr("ng-repeat",u+" | limitTo:ofs | limitTo:lim"),function(a,c){function f(){var b=V.length,c=b%o,d=b-N;c>d&&(d=c);var e=d-X;0!==e&&(i(V,X,e,M),X=d),Z=(b-d)/o*O;var f=Q-a.ofs/o,g=W.length;if(f>0){var h=P%o,j=f*o+h;g=W.length-j,0>g&&(g=h),g>W.length&&(g=W.length)}var k=g-Y;0!==k&&(i(W,Y,k,M,!0),Y=g)}function i(a,b,c,d,e){if(c>0)for(var f=b;b+c>f;f++)a[f].css("display","none");else if(0>c)for(var g=b-1;g>=b+c;g--)a[g].css("display",d)}function u(){U=!0;for(var a=0;p>a;a++){var d=J();V.push(d),c.prepend(d)}for(var e=0;p>e;e++){var f=J();W.push(f),c.append(f)}angular.isUndefined(M)&&(M=V[0].css("display")),w(),V.length<r&&b(u,q)}function w(){f(),K=Math.floor(N/o)*O-Z;var a=Math.ceil(n/o);L=K+a*O,I(K)}function x(b){if(N=b,P>0){var c=S+b,d=S;if(N+d>P){var e=N+d-P;d-=e}a.ofs=c,a.lim=-1*d}else a.ofs=n,a.lim=-1*n;w()}function y(){var a=0;if(O>0){var b=v-R;0>b&&(b=0),a=Math.round(b/O)*o-d,0>a&&(a=0)}var c=Q*o-S;0>c&&(c=0),a>c&&(a=c),x(a)}function z(){var b=K>v,c=v+e>L;a.scrollRepeatClippingTop!==b&&a.$apply(function(){a.scrollRepeatClippingTop=b}),a.scrollRepeatClippingBottom!==c&&a.$apply(function(){a.scrollRepeatClippingBottom=c})}function A(){T=Q*O,t.css("height",T+"px")}function B(){if(C(),0===O)n=l,d=0;else{var a=Math.round(e/(O/o));n=a+a*l,n>m&&(n=m),d=Math.round((n-a)/2),d-=d%o}var b=P%o;Q=(0===b?P:P+(o-b))/o,S=n>P?P:n-n%o,y(),A()}function C(){O=G(),o=E(),R=F()}function E(){for(var a,b=1,d=c.children(),e=0,f=X,g=X+P,h=f;g>=h;h++){var i=d[h];if(!i||"object"!=typeof i)break;var j=H(i,"offsetTop");if(j>=0){if(angular.isUndefined(a)&&(a=j),j!=a)break;b=e+1,e++}}return b}function F(){return c[0].offsetTop}function G(){return H(c.children()[V.length],"offsetHeight")}function H(a,b){var c=0;if(a&&"object"==typeof a){var d=a[b],e=angular.element(a).children()[0];if(e&&"object"==typeof e){var f=e[b];c=d>f?d:f}}return c}function I(a){var b="translateY("+a+"px)";c.css("transform",b),c.css("webkitTransform",b),c.css("mozTransform",b)}function J(){var a=angular.element(j),b=angular.element(s);return g&&b.append(angular.element(g.clone())),a.append(b),a}var K,L,M,N=0,O=0,P=0,Q=0,R=0,S=0,T=0,U=!1,V=[],W=[],X=0,Y=0,Z=0;a.scrollRepeatClippingTop=!1,a.scrollRepeatClippingBottom=!1,y(),a.$watchCollection(D,function(a){a&&(P=a.length),b(function(){B(),P>0&&!U&&P>n&&u()})}),k=function(b){"debounced"!=b||a.scrollRepeatClippingTop||a.scrollRepeatClippingBottom?"ended"==b&&y():y(),z()},h=function(a){a.widthChanged&&B()}}}}}]);